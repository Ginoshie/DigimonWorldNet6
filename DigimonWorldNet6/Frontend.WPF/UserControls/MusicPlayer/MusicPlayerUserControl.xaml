<UserControl x:Class="DigimonWorld.Frontend.WPF.UserControls.MusicPlayer.MusicPlayerUserControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:musicPlayer="clr-namespace:DigimonWorld.Frontend.WPF.UserControls.MusicPlayer"
             xmlns:system="clr-namespace:System;assembly=System.Runtime"
             mc:Ignorable="d"
             d:DataContext="{d:DesignInstance Type=musicPlayer:MusicPlayerViewModel, IsDesignTimeCreatable=True}">

    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="../../ResourceDictionaries/Styles/Buttons/DefaultButtonStyle.xaml" />
                <ResourceDictionary Source="../../ResourceDictionaries/Styles/ProgressBarStyle.xaml" />
                <ResourceDictionary Source="../../ResourceDictionaries/ControlTemplates/DefaultHorizontalSlider.xaml" />
            </ResourceDictionary.MergedDictionaries>

            <system:Double x:Key="ButtonDimension">40</system:Double>
            <system:Double x:Key="ButtonFontSize">25</system:Double>

        </ResourceDictionary>
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="auto" />
            <RowDefinition Height="auto" />
            <RowDefinition Height="auto" />
            <RowDefinition Height="auto" />
        </Grid.RowDefinitions>
        <TextBlock Grid.Row="0"
                   Text="{Binding CurrentSongTitle}"
                   Foreground="#D6D6D8"
                   FontSize="16"
                   Margin="0, 10"
                   TextWrapping="Wrap" />

        <Grid Grid.Row="1" VerticalAlignment="Center">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <TextBlock Grid.Column="0" Text="{Binding CurrentPositionString}"
                       Foreground="#B3B5B1"
                       VerticalAlignment="Center"
                       HorizontalAlignment="Left"
                       Margin="0,0,5,0"
                       Height="10" />

            <ProgressBar Grid.Column="1" Value="{Binding CurrentPosition}"
                         Style="{StaticResource  CustomProgressBarStyle}"
                         Minimum="0"
                         Maximum="{Binding SongLength}"
                         VerticalAlignment="Center"
                         HorizontalAlignment="Stretch"
                         Margin="0,0,0,0"
                         Height="10" />

            <TextBlock Grid.Column="2" Text="{Binding SongLengthString}"
                       Foreground="#B3B5B1"
                       VerticalAlignment="Center"
                       HorizontalAlignment="Right"
                       Margin="5,0,0,0"
                       Height="10" />
        </Grid>

        <StackPanel Grid.Row="2" Orientation="Horizontal" Margin="0,10">
            <!-- Shuffle button -->
            <Button Height="{StaticResource ButtonDimension}" Width="{StaticResource ButtonDimension}" FontSize="{StaticResource ButtonFontSize}" Content="ðŸ”€" Margin="0, 0, 1, 0"
                    Command="{Binding ToggleShuffleCommand}">
                <Button.Style>
                    <Style TargetType="{x:Type Button}">
                        <Setter Property="HorizontalAlignment" Value="Center" />
                        <Setter Property="Opacity" Value="0.5" />
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="Button">
                                    <Grid>
                                        <!-- Outer Border -->
                                        <Border x:Name="OuterBorder" BorderBrush="#B0B0B0" BorderThickness="3,3,0,0" Background="#575C60">
                                            <!-- Inner Border for Bottom and Right -->
                                            <Border x:Name="InnerBorder" BorderBrush="#060100" BorderThickness="0,0,3,3">
                                                <!-- ContentPresenter to show the button content -->
                                                <ContentPresenter VerticalAlignment="Center" HorizontalAlignment="Center" />
                                            </Border>
                                        </Border>
                                    </Grid>
                                    <!-- ControlTemplate Triggers -->
                                    <ControlTemplate.Triggers>
                                        <!-- IsPressed Trigger to change border color when pressed -->
                                        <Trigger Property="IsPressed" Value="True">
                                            <Setter TargetName="OuterBorder" Property="BorderBrush" Value="#060100" />
                                            <Setter TargetName="InnerBorder" Property="BorderBrush" Value="#6789A5" />
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                        <!-- Style-Level Triggers -->
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding ShuffleEnabled}" Value="True">
                                <Setter Property="Opacity" Value="1.0" />
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Button.Style>
            </Button>

            <!-- Previous track button -->
            <Button Height="{StaticResource ButtonDimension}" Width="{StaticResource ButtonDimension}" FontSize="{StaticResource ButtonFontSize}" Content="â®ï¸" Margin="15, 0, 0, 0"
                    Command="{Binding PreviousSongCommand}" Style="{StaticResource DefaultButtonStyle}" />

            <!-- Play/Pause button -->
            <Button Height="{StaticResource ButtonDimension}" Width="{StaticResource ButtonDimension}" FontSize="{StaticResource ButtonFontSize}" Content="â¯ï¸" Margin="0, 0, 0, 0"
                    Command="{Binding PlayPauseCommand}" Style="{StaticResource DefaultButtonStyle}" />

            <!-- Next track button -->
            <Button Height="{StaticResource ButtonDimension}" Width="{StaticResource ButtonDimension}" FontSize="{StaticResource ButtonFontSize}" Content="â­ï¸" Margin="0, 0, 15, 0"
                    Command="{Binding NextSongCommand}" Style="{StaticResource DefaultButtonStyle}" />

            <!-- Repeat button -->
            <Button Height="{StaticResource ButtonDimension}" Width="{StaticResource ButtonDimension}" FontSize="{StaticResource ButtonFontSize}" Content="ðŸ”" Margin="0, 0, 0, 0"
                    Command="{Binding ToggleRepeatSingleSongCommand}">
                <Button.Style>
                    <Style TargetType="{x:Type Button}">
                        <Setter Property="HorizontalAlignment" Value="Center" />
                        <Setter Property="Opacity" Value="0.5" />
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="Button">
                                    <Grid>
                                        <!-- Outer Border -->
                                        <Border x:Name="OuterBorder" BorderBrush="#B0B0B0" BorderThickness="3,3,0,0" Background="#575C60">
                                            <!-- Inner Border for Bottom and Right -->
                                            <Border x:Name="InnerBorder" BorderBrush="#060100" BorderThickness="0,0,3,3">
                                                <!-- ContentPresenter to show the button content -->
                                                <ContentPresenter VerticalAlignment="Center" HorizontalAlignment="Center" />
                                            </Border>
                                        </Border>
                                    </Grid>
                                    <!-- ControlTemplate Triggers -->
                                    <ControlTemplate.Triggers>
                                        <!-- IsPressed Trigger to change border color when pressed -->
                                        <Trigger Property="IsPressed" Value="True">
                                            <Setter TargetName="OuterBorder" Property="BorderBrush" Value="#060100" />
                                            <Setter TargetName="InnerBorder" Property="BorderBrush" Value="#6789A5" />
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                        <!-- Style-Level Triggers -->
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding RepeatSingleSongEnabled}" Value="True">
                                <Setter Property="Opacity" Value="1.0" />
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Button.Style>
            </Button>
        </StackPanel>

        <Grid Grid.Row="3">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>
            <!-- Grid wrapping Slider and Volume Label -->
            <StackPanel Grid.Column="0" Orientation="Vertical" HorizontalAlignment="Stretch" VerticalAlignment="Center">
                <!-- This Grid will center the Volume label and value above the Slider -->
                <Grid HorizontalAlignment="Center">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <!-- Volume Label -->
                    <TextBlock Grid.Column="0"
                               Foreground="#B3B5B1" VerticalAlignment="Bottom" TextAlignment="Right" Margin="0,5">
                        Volume:&#160;
                    </TextBlock>

                    <!-- Volume value with fixed width -->
                    <TextBlock Grid.Column="1" Foreground="#B3B5B1" VerticalAlignment="Bottom" HorizontalAlignment="Center" Width="22" Margin="0,5">
                        <Run Text="{Binding ElementName=VolumeSlider, Path=Value}" />
                    </TextBlock>
                </Grid>

                <!-- Slider control that takes up all available width -->
                <Slider x:Name="VolumeSlider" Template="{StaticResource DefaultHorizontalSlider}" Focusable="False" SnapsToDevicePixels="True"
                        Minimum="0" Maximum="100" Value="{Binding Volume, Mode=TwoWay}" TickFrequency="10" IsSnapToTickEnabled="False" 
                        IsMoveToPointEnabled="True" VerticalAlignment="Center" HorizontalAlignment="Stretch" />
            </StackPanel>

            <!-- Mute/Unmute button -->
            <Button Grid.Column="1" Height="{StaticResource ButtonDimension}" Width="{StaticResource ButtonDimension}" Margin="15, 10, 0,10" Command="{Binding ToggleMuteEnabledCommand}">
                <Button.Style>
                    <Style TargetType="{x:Type Button}">
                        <Setter Property="HorizontalAlignment" Value="Center" />
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="Button">
                                    <Grid>
                                        <Border x:Name="OuterBorder" BorderBrush="#B0B0B0" BorderThickness="3,3,0,0" Background="#575C60">
                                            <Border x:Name="InnerBorder" BorderBrush="#060100" BorderThickness="0,0,3,3">
                                                <TextBlock x:Name="Icon" VerticalAlignment="Center" HorizontalAlignment="Center" FontSize="{StaticResource ButtonFontSize}" Text="ðŸ”Š" />
                                            </Border>
                                        </Border>
                                    </Grid>
                                    <ControlTemplate.Triggers>
                                        <!-- Change Icon based on Volume -->
                                        <DataTrigger Binding="{Binding Volume}" Value="0">
                                            <Setter TargetName="Icon" Property="TextBlock.Text" Value="ðŸ”‡" />
                                        </DataTrigger>
                                        <!-- Trigger for IsPressed to change BorderBrush -->
                                        <Trigger Property="IsPressed" Value="True">
                                            <Setter TargetName="OuterBorder" Property="BorderBrush" Value="#060100" />
                                            <Setter TargetName="InnerBorder" Property="BorderBrush" Value="#6789A5" />
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                    </Style>
                </Button.Style>
            </Button>

        </Grid>
    </Grid>
</UserControl>